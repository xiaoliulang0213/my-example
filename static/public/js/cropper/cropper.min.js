!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],b):b(a.jQuery)}(this,function(a){"use strict";function V(a){return"string"==typeof a}function X(a){return"number"==typeof a&&!W(a)}function Y(a){return"undefined"==typeof a}function Z(a,b){for(var c=arguments.length,d=Array(c>2?c-2:0),e=2;c>e;e++)d[e-2]=arguments[e];return function(){for(var c=arguments.length,e=Array(c),f=0;c>f;f++)e[f]=arguments[f];return a.apply(b,d.concat(e))}}function bb(a){var b=a.match(ab);return b&&(b[1]!==_.protocol||b[2]!==_.hostname||b[3]!==_.port)}function cb(a){var b="timestamp="+(new Date).getTime();return a+(-1===a.indexOf("?")?"?":"&")+b}function db(a){var b=a.rotate,c=a.scaleX,d=a.scaleY,e=a.translateX,f=a.translateY,g=[];return X(e)&&0!==e&&g.push("translateX("+e+"px)"),X(f)&&0!==f&&g.push("translateY("+f+"px)"),X(b)&&0!==b&&g.push("rotate("+b+"deg)"),X(c)&&1!==c&&g.push("scaleX("+c+")"),X(d)&&1!==d&&g.push("scaleY("+d+")"),g.length?g.join(" "):"none"}function gb(a,b){if(a.naturalWidth&&!fb)return b(a.naturalWidth,a.naturalHeight),void 0;var c=document.createElement("img");c.onload=function(){b(c.width,c.height)},c.src=a.src}function hb(b){var c=a.extend({},b),d=[];return a.each(b,function(b,e){delete c[b],a.each(c,function(a,b){var c=Math.abs(e.startX-b.startX),f=Math.abs(e.startY-b.startY),g=Math.abs(e.endX-b.endX),h=Math.abs(e.endY-b.endY),i=Math.sqrt(c*c+f*f),j=Math.sqrt(g*g+h*h),k=(j-i)/i;d.push(k)})}),d.sort(function(a,b){return Math.abs(a)<Math.abs(b)}),d[0]}function ib(b,c){var d=b.pageX,e=b.pageY,f={endX:d,endY:e};return c?f:a.extend({startX:d,startY:e},f)}function jb(b){var c=0,d=0,e=0;return a.each(b,function(a,b){var f=b.startX,g=b.startY;c+=f,d+=g,e+=1}),c/=e,d/=e,{pageX:c,pageY:d}}function lb(a){var b=a.aspectRatio,c=a.height,d=a.width,e=function(a){return kb(a)&&a>0};return e(d)&&e(c)?c*b>d?c=d/b:d=c*b:e(d)?c=d/b:e(c)&&(d=c*b),{width:d,height:c}}function mb(a){var e,f,g,b=a.width,c=a.height,d=a.degree;return d=Math.abs(d),90===d%180?{width:c,height:b}:(e=d%90*Math.PI/180,f=Math.sin(e),g=Math.cos(e),{width:b*g+c*f,height:b*f+c*g})}function nb(a,b,c,d){var e=b.naturalWidth,f=b.naturalHeight,g=b.rotate,h=b.scaleX,i=b.scaleY,j=c.aspectRatio,k=c.naturalWidth,l=c.naturalHeight,m=d.fillColor,n=void 0===m?"transparent":m,o=d.imageSmoothingEnabled,p=void 0===o?!0:o,q=d.imageSmoothingQuality,r=void 0===q?"low":q,s=d.maxWidth,t=void 0===s?1/0:s,u=d.maxHeight,v=void 0===u?1/0:u,w=d.minWidth,x=void 0===w?0:w,y=d.minHeight,z=void 0===y?0:y,A=lb({aspectRatio:j,width:t,height:v}),B=lb({aspectRatio:j,width:x,height:z}),C=Math.min(A.width,Math.max(B.width,k)),D=Math.min(A.height,Math.max(B.height,l)),E=document.createElement("canvas"),F=E.getContext("2d");return E.width=C,E.height=D,F.fillStyle=n,F.fillRect(0,0,C,D),F.save(),F.translate(C/2,D/2),F.rotate(g*Math.PI/180),F.scale(h,i),F.imageSmoothingEnabled=!!p,F.imageSmoothingQuality=r,F.drawImage(a,Math.floor(-e/2),Math.floor(-f/2),Math.floor(e),Math.floor(f)),F.restore(),E}function pb(a,b,c){var d="",e=void 0;for(c+=b,e=b;c>e;e+=1)d+=ob(a.getUint8(e));return d}function rb(b){var c=b.replace(qb,""),d=atob(c),e=new ArrayBuffer(d.length),f=new Uint8Array(e);return a.each(f,function(a){f[a]=d.charCodeAt(a)}),e}function sb(b,c){var d=new Uint8Array(b),e="";return a.each(d,function(a,b){e+=ob(b)}),"data:"+c+";base64,"+btoa(e)}function tb(a){var g,h,i,j,k,l,m,n,o,b=new DataView(a),c=void 0,d=void 0,e=void 0,f=void 0;if(255===b.getUint8(0)&&216===b.getUint8(1))for(g=b.byteLength,h=2;g>h;){if(255===b.getUint8(h)&&225===b.getUint8(h+1)){e=h;break}h+=1}if(e&&(i=e+4,j=e+10,"Exif"===pb(b,i,4)&&(k=b.getUint16(j),d=18761===k,(d||19789===k)&&42===b.getUint16(j+2,d)&&(l=b.getUint32(j+4,d),l>=8&&(f=j+l)))),f)for(m=b.getUint16(f,d),n=void 0,o=void 0,o=0;m>o;o+=1)if(n=f+12*o+2,274===b.getUint16(n,d)){n+=8,c=b.getUint16(n,d),b.setUint16(n,1,d);break}return c}function ub(a){var b=0,c=1,d=1;switch(a){case 2:c=-1;break;case 3:b=-180;break;case 4:d=-1;break;case 5:b=90,d=-1;break;case 6:b=90;break;case 7:b=90,c=-1;break;case 8:b=-90}return{rotate:b,scaleX:c,scaleY:d}}function Cb(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,W,$,_,ab,eb,fb,kb,ob,qb,vb,wb,xb,yb,zb,Ab,Bb,Db,Eb;a=a&&a.hasOwnProperty("default")?a["default"]:a,b="undefined"!=typeof window?window:{},c="cropper",d="all",e="crop",f="move",g="zoom",h="e",i="w",j="s",k="n",l="ne",m="nw",n="se",o="sw",p=c+"-crop",q=c+"-disabled",r=c+"-hidden",s=c+"-hide",t=c+"-invisible",u=c+"-modal",v=c+"-move",w="action",x="preview",y="crop",z="move",A="none",B="crop",C="cropend",D="cropmove",E="cropstart",F="dblclick",G="error",H="load",I=b.PointerEvent?"pointerdown":"touchstart mousedown",J=b.PointerEvent?"pointermove":"touchmove mousemove",K=b.PointerEvent?" pointerup pointercancel":"touchend touchcancel mouseup",L="ready",M="resize",N="wheel mousewheel DOMMouseScroll",O="zoom",P=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,Q=/^data:/,R=/^data:image\/jpeg;base64,/,S=/^(img|canvas)$/i,T={viewMode:0,dragMode:y,aspectRatio:0/0,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},U='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',W=Number.isNaN||b.isNaN,$=Object.keys||function(b){var c=[];return a.each(b,function(a){c.push(a)}),c},_=b.location,ab=/^(https?:)\/\/([^:\/?#]+):?(\d*)/i,eb=b.navigator,fb=eb&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(eb.userAgent),kb=Number.isFinite||b.isFinite,ob=String.fromCharCode,qb=/^data:.*,/,vb={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var a=this.$element,b=this.options,c=this.$container,d=this.$cropper;d.addClass(r),a.removeClass(r),d.css(this.container={width:Math.max(c.width(),Number(b.minContainerWidth)||200),height:Math.max(c.height(),Number(b.minContainerHeight)||100)}),a.addClass(r),d.removeClass(r)},initCanvas:function(){var k,b=this.container,c=this.image,d=this.options.viewMode,e=90===Math.abs(c.rotate)%180,f=e?c.naturalHeight:c.naturalWidth,g=e?c.naturalWidth:c.naturalHeight,h=f/g,i=b.width,j=b.height;b.height*h>b.width?3===d?i=b.height*h:j=b.width/h:3===d?j=b.width/h:i=b.height*h,k={aspectRatio:h,naturalWidth:f,naturalHeight:g,width:i,height:j},k.left=(b.width-i)/2,k.top=(b.height-j)/2,k.oldLeft=k.left,k.oldTop=k.top,this.canvas=k,this.limited=1===d||2===d,this.limitCanvas(!0,!0),this.initialImage=a.extend({},c),this.initialCanvas=a.extend({},k)},limitCanvas:function(a,b){var j,k,l,m,n,c=this.options,d=this.container,e=this.canvas,f=this.cropBox,g=c.viewMode,h=e.aspectRatio,i=this.cropped&&f;a&&(j=Number(c.minCanvasWidth)||0,k=Number(c.minCanvasHeight)||0,g>0&&(g>1?(j=Math.max(j,d.width),k=Math.max(k,d.height),3===g&&(k*h>j?j=k*h:k=j/h)):j?j=Math.max(j,i?f.width:0):k?k=Math.max(k,i?f.height:0):i&&(j=f.width,k=f.height,k*h>j?j=k*h:k=j/h)),l=lb({aspectRatio:h,width:j,height:k}),j=l.width,k=l.height,e.minWidth=j,e.minHeight=k,e.maxWidth=1/0,e.maxHeight=1/0),b&&(g>0?(m=d.width-e.width,n=d.height-e.height,e.minLeft=Math.min(0,m),e.minTop=Math.min(0,n),e.maxLeft=Math.max(0,m),e.maxTop=Math.max(0,n),i&&this.limited&&(e.minLeft=Math.min(f.left,f.left+f.width-e.width),e.minTop=Math.min(f.top,f.top+f.height-e.height),e.maxLeft=f.left,e.maxTop=f.top,2===g&&(e.width>=d.width&&(e.minLeft=Math.min(0,m),e.maxLeft=Math.max(0,m)),e.height>=d.height&&(e.minTop=Math.min(0,n),e.maxTop=Math.max(0,n))))):(e.minLeft=-e.width,e.minTop=-e.height,e.maxLeft=d.width,e.maxTop=d.height))},renderCanvas:function(a,b){var e,f,g,h,i,c=this.canvas,d=this.image;b&&(e=mb({width:d.naturalWidth*Math.abs(d.scaleX||1),height:d.naturalHeight*Math.abs(d.scaleY||1),degree:d.rotate}),f=e.width,g=e.height,h=c.width*(f/c.naturalWidth),i=c.height*(g/c.naturalHeight),c.left-=(h-c.width)/2,c.top-=(i-c.height)/2,c.width=h,c.height=i,c.aspectRatio=f/g,c.naturalWidth=f,c.naturalHeight=g,this.limitCanvas(!0,!1)),(c.width>c.maxWidth||c.width<c.minWidth)&&(c.left=c.oldLeft),(c.height>c.maxHeight||c.height<c.minHeight)&&(c.top=c.oldTop),c.width=Math.min(Math.max(c.width,c.minWidth),c.maxWidth),c.height=Math.min(Math.max(c.height,c.minHeight),c.maxHeight),this.limitCanvas(!1,!0),c.left=Math.min(Math.max(c.left,c.minLeft),c.maxLeft),c.top=Math.min(Math.max(c.top,c.minTop),c.maxTop),c.oldLeft=c.left,c.oldTop=c.top,this.$canvas.css({width:c.width,height:c.height,transform:db({translateX:c.left,translateY:c.top})}),this.renderImage(a),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(b){var c=this.canvas,d=this.image,e=d.naturalWidth*(c.width/c.naturalWidth),f=d.naturalHeight*(c.height/c.naturalHeight);a.extend(d,{width:e,height:f,left:(c.width-e)/2,top:(c.height-f)/2}),this.$clone.css({width:d.width,height:d.height,transform:db(a.extend({translateX:d.left,translateY:d.top},d))}),b&&this.output()},initCropBox:function(){var b=this.options,c=this.canvas,d=b.aspectRatio,e=Number(b.autoCropArea)||.8,f={width:c.width,height:c.height};d&&(c.height*d>c.width?f.height=f.width/d:f.width=f.height*d),this.cropBox=f,this.limitCropBox(!0,!0),f.width=Math.min(Math.max(f.width,f.minWidth),f.maxWidth),f.height=Math.min(Math.max(f.height,f.minHeight),f.maxHeight),f.width=Math.max(f.minWidth,f.width*e),f.height=Math.max(f.minHeight,f.height*e),f.left=c.left+(c.width-f.width)/2,f.top=c.top+(c.height-f.height)/2,f.oldLeft=f.left,f.oldTop=f.top,this.initialCropBox=a.extend({},f)},limitCropBox:function(a,b){var i,j,k,l,c=this.options,d=this.container,e=this.canvas,f=this.cropBox,g=this.limited,h=c.aspectRatio;a&&(i=Number(c.minCropBoxWidth)||0,j=Number(c.minCropBoxHeight)||0,k=Math.min(d.width,g?e.width:d.width),l=Math.min(d.height,g?e.height:d.height),i=Math.min(i,d.width),j=Math.min(j,d.height),h&&(i&&j?j*h>i?j=i/h:i=j*h:i?j=i/h:j&&(i=j*h),l*h>k?l=k/h:k=l*h),f.minWidth=Math.min(i,k),f.minHeight=Math.min(j,l),f.maxWidth=k,f.maxHeight=l),b&&(g?(f.minLeft=Math.max(0,e.left),f.minTop=Math.max(0,e.top),f.maxLeft=Math.min(d.width,e.left+e.width)-f.width,f.maxTop=Math.min(d.height,e.top+e.height)-f.height):(f.minLeft=0,f.minTop=0,f.maxLeft=d.width-f.width,f.maxTop=d.height-f.height))},renderCropBox:function(){var a=this.options,b=this.container,c=this.cropBox;(c.width>c.maxWidth||c.width<c.minWidth)&&(c.left=c.oldLeft),(c.height>c.maxHeight||c.height<c.minHeight)&&(c.top=c.oldTop),c.width=Math.min(Math.max(c.width,c.minWidth),c.maxWidth),c.height=Math.min(Math.max(c.height,c.minHeight),c.maxHeight),this.limitCropBox(!1,!0),c.left=Math.min(Math.max(c.left,c.minLeft),c.maxLeft),c.top=Math.min(Math.max(c.top,c.minTop),c.maxTop),c.oldLeft=c.left,c.oldTop=c.top,a.movable&&a.cropBoxMovable&&this.$face.data(w,c.width>=b.width&&c.height>=b.height?f:d),this.$cropBox.css({width:c.width,height:c.height,transform:db({translateX:c.left,translateY:c.top})}),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),this.completed&&this.trigger(B,this.getData())}},wb={initPreview:function(){var e,b=this.crossOrigin,c=b?this.crossOriginUrl:this.url,d=document.createElement("img");b&&(d.crossOrigin=b),d.src=c,e=a(d),this.$preview=a(this.options.preview),this.$clone2=e,this.$viewBox.html(e),this.$preview.each(function(d,e){var f=a(e),g=document.createElement("img");f.data(x,{width:f.width(),height:f.height(),html:f.html()}),b&&(g.crossOrigin=b),g.src=c,g.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',f.html(g)})},resetPreview:function(){this.$preview.each(function(b,c){var d=a(c),e=d.data(x);d.css({width:e.width,height:e.height}).html(e.html).removeData(x)})},preview:function(){var b=this.image,c=this.canvas,d=this.cropBox,e=d.width,f=d.height,g=b.width,h=b.height,i=d.left-c.left-b.left,j=d.top-c.top-b.top;this.cropped&&!this.disabled&&(this.$clone2.css({width:g,height:h,transform:db(a.extend({translateX:-i,translateY:-j},b))}),this.$preview.each(function(c,d){var k=a(d),l=k.data(x),m=l.width,n=l.height,o=m,p=n,q=1;e&&(q=m/e,p=f*q),f&&p>n&&(q=n/f,o=e*q,p=n),k.css({width:o,height:p}).find("img").css({width:g*q,height:h*q,transform:db(a.extend({translateX:-i*q,translateY:-j*q},b))})}))}},xb={bind:function(){var c=this.$element,d=this.options,e=this.$cropper;a.isFunction(d.cropstart)&&c.on(E,d.cropstart),a.isFunction(d.cropmove)&&c.on(D,d.cropmove),a.isFunction(d.cropend)&&c.on(C,d.cropend),a.isFunction(d.crop)&&c.on(B,d.crop),a.isFunction(d.zoom)&&c.on(O,d.zoom),e.on(I,Z(this.cropStart,this)),d.zoomable&&d.zoomOnWheel&&e.on(N,Z(this.wheel,this)),d.toggleDragModeOnDblclick&&e.on(F,Z(this.dblclick,this)),a(document).on(J,this.onCropMove=Z(this.cropMove,this)).on(K,this.onCropEnd=Z(this.cropEnd,this)),d.responsive&&a(b).on(M,this.onResize=Z(this.resize,this))},unbind:function(){var c=this.$element,d=this.options,e=this.$cropper;a.isFunction(d.cropstart)&&c.off(E,d.cropstart),a.isFunction(d.cropmove)&&c.off(D,d.cropmove),a.isFunction(d.cropend)&&c.off(C,d.cropend),a.isFunction(d.crop)&&c.off(B,d.crop),a.isFunction(d.zoom)&&c.off(O,d.zoom),e.off(I,this.cropStart),d.zoomable&&d.zoomOnWheel&&e.off(N,this.wheel),d.toggleDragModeOnDblclick&&e.off(F,this.dblclick),a(document).off(J,this.onCropMove).off(K,this.onCropEnd),d.responsive&&a(b).off(M,this.onResize)}},yb={resize:function(){var g,h,i,b=this.options,c=this.$container,d=this.container,e=Number(b.minContainerWidth)||200,f=Number(b.minContainerHeight)||100;this.disabled||d.width<=e||d.height<=f||(g=c.width()/d.width,(1!==g||c.height()!==d.height)&&(h=void 0,i=void 0,b.restore&&(h=this.getCanvasData(),i=this.getCropBoxData()),this.render(),b.restore&&(this.setCanvasData(a.each(h,function(a,b){h[a]=b*g})),this.setCropBoxData(a.each(i,function(a,b){i[a]=b*g})))))},dblclick:function(){this.disabled||this.options.dragMode===A||this.setDragMode(this.$dragBox.hasClass(p)?z:y)},wheel:function(a){var e,b=this,c=a.originalEvent||a,d=Number(this.options.wheelZoomRatio)||.1;this.disabled||(a.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(function(){b.wheeling=!1},50),e=1,c.deltaY?e=c.deltaY>0?1:-1:c.wheelDelta?e=-c.wheelDelta/120:c.detail&&(e=c.detail>0?1:-1),this.zoom(-e*d,a)))},cropStart:function(b){var c,d,f,h;this.disabled||(c=this.options,d=this.pointers,f=b.originalEvent,h=void 0,f&&f.changedTouches?a.each(f.changedTouches,function(a,b){d[b.identifier]=ib(b)}):d[f&&f.pointerId||0]=ib(f||b),h=$(d).length>1&&c.zoomable&&c.zoomOnTouch?g:a(b.target).data(w),P.test(h)&&(this.trigger(E,{originalEvent:f,action:h}).isDefaultPrevented()||(b.preventDefault(),this.action=h,this.cropping=!1,h===e&&(this.cropping=!0,this.$dragBox.addClass(u)))))},cropMove:function(b){var d,e,c=this.action;!this.disabled&&c&&(d=this.pointers,e=b.originalEvent,b.preventDefault(),this.trigger(D,{originalEvent:e,action:c}).isDefaultPrevented()||(e&&e.changedTouches?a.each(e.changedTouches,function(b,c){a.extend(d[c.identifier],ib(c,!0))}):a.extend(d[e&&e.pointerId||0],ib(e||b,!0)),this.change(b)))},cropEnd:function(b){var c,d,e;this.disabled||(c=this.action,d=this.pointers,e=b.originalEvent,e&&e.changedTouches?a.each(e.changedTouches,function(a,b){delete d[b.identifier]}):delete d[e&&e.pointerId||0],c&&(b.preventDefault(),$(d).length||(this.action=""),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(u,this.cropped&&this.options.modal)),this.trigger(C,{originalEvent:e,action:c})))}},zb={change:function(b){var I,J,K,c=this.options,p=this.pointers,q=this.container,s=this.canvas,t=this.cropBox,u=this.action,v=c.aspectRatio,w=t.left,x=t.top,y=t.width,z=t.height,A=w+y,B=x+z,C=0,D=0,E=q.width,F=q.height,G=!0,H=void 0;switch(!v&&b.shiftKey&&(v=y&&z?y/z:1),this.limited&&(C=t.minLeft,D=t.minTop,E=C+Math.min(q.width,s.width,s.left+s.width),F=D+Math.min(q.height,s.height,s.top+s.height)),I=p[$(p)[0]],J={x:I.endX-I.startX,y:I.endY-I.startY},K=function(a){switch(a){case h:A+J.x>E&&(J.x=E-A);break;case i:w+J.x<C&&(J.x=C-w);break;case k:x+J.y<D&&(J.y=D-x);break;case j:B+J.y>F&&(J.y=F-B)}},u){case d:w+=J.x,x+=J.y;break;case h:if(J.x>=0&&(A>=E||v&&(D>=x||B>=F))){G=!1;break}K(h),y+=J.x,v&&(z=y/v,x-=J.x/v/2),0>y&&(u=i,y=0);break;case k:if(J.y<=0&&(D>=x||v&&(C>=w||A>=E))){G=!1;break}K(k),z-=J.y,x+=J.y,v&&(y=z*v,w+=J.y*v/2),0>z&&(u=j,z=0);break;case i:if(J.x<=0&&(C>=w||v&&(D>=x||B>=F))){G=!1;break}K(i),y-=J.x,w+=J.x,v&&(z=y/v,x+=J.x/v/2),0>y&&(u=h,y=0);break;case j:if(J.y>=0&&(B>=F||v&&(C>=w||A>=E))){G=!1;break}K(j),z+=J.y,v&&(y=z*v,w-=J.y*v/2),0>z&&(u=k,z=0);break;case l:if(v){if(J.y<=0&&(D>=x||A>=E)){G=!1;break}K(k),z-=J.y,x+=J.y,y=z*v}else K(k),K(h),J.x>=0?E>A?y+=J.x:J.y<=0&&D>=x&&(G=!1):y+=J.x,J.y<=0?x>D&&(z-=J.y,x+=J.y):(z-=J.y,x+=J.y);0>y&&0>z?(u=o,z=0,y=0):0>y?(u=m,y=0):0>z&&(u=n,z=0);break;case m:if(v){if(J.y<=0&&(D>=x||C>=w)){G=!1;break}K(k),z-=J.y,x+=J.y,y=z*v,w+=J.y*v}else K(k),K(i),J.x<=0?w>C?(y-=J.x,w+=J.x):J.y<=0&&D>=x&&(G=!1):(y-=J.x,w+=J.x),J.y<=0?x>D&&(z-=J.y,x+=J.y):(z-=J.y,x+=J.y);0>y&&0>z?(u=n,z=0,y=0):0>y?(u=l,y=0):0>z&&(u=o,z=0);break;case o:if(v){if(J.x<=0&&(C>=w||B>=F)){G=!1;break}K(i),y-=J.x,w+=J.x,z=y/v}else K(j),K(i),J.x<=0?w>C?(y-=J.x,w+=J.x):J.y>=0&&B>=F&&(G=!1):(y-=J.x,w+=J.x),J.y>=0?F>B&&(z+=J.y):z+=J.y;0>y&&0>z?(u=l,z=0,y=0):0>y?(u=n,y=0):0>z&&(u=m,z=0);break;case n:if(v){if(J.x>=0&&(A>=E||B>=F)){G=!1;break}K(h),y+=J.x,z=y/v}else K(j),K(h),J.x>=0?E>A?y+=J.x:J.y>=0&&B>=F&&(G=!1):y+=J.x,J.y>=0?F>B&&(z+=J.y):z+=J.y;0>y&&0>z?(u=m,z=0,y=0):0>y?(u=o,y=0):0>z&&(u=l,z=0);break;case f:this.move(J.x,J.y),G=!1;break;case g:this.zoom(hb(p),b.originalEvent),G=!1;break;case e:if(!J.x||!J.y){G=!1;break}H=this.$cropper.offset(),w=I.startX-H.left,x=I.startY-H.top,y=t.minWidth,z=t.minHeight,J.x>0?u=J.y>0?n:l:J.x<0&&(w-=y,u=J.y>0?o:m),J.y<0&&(x-=z),this.cropped||(this.$cropBox.removeClass(r),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}G&&(t.width=y,t.height=z,t.left=w,t.top=x,this.action=u,this.renderCropBox()),a.each(p,function(a,b){b.startX=b.endX,b.startY=b.endY})}},Ab={crop:function(){this.ready&&!this.disabled&&(this.cropped||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass(u),this.$cropBox.removeClass(r)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.ready&&!this.disabled&&(this.image=a.extend({},this.initialImage),this.canvas=a.extend({},this.initialCanvas),this.cropBox=a.extend({},this.initialCropBox),this.renderCanvas(),this.cropped&&this.renderCropBox())},clear:function(){this.cropped&&!this.disabled&&(a.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass(u),this.$cropBox.addClass(r))},replace:function(a,b){!this.disabled&&a&&(this.isImg&&this.$element.attr("src",a),b?(this.url=a,this.$clone.attr("src",a),this.ready&&this.$preview.find("img").add(this.$clone2).attr("src",a)):(this.isImg&&(this.replaced=!0),this.options.data=null,this.load(a)))},enable:function(){this.ready&&(this.disabled=!1,this.$cropper.removeClass(q))},disable:function(){this.ready&&(this.disabled=!0,this.$cropper.addClass(q))},destroy:function(){var a=this.$element;this.loaded?(this.isImg&&this.replaced&&a.attr("src",this.originalUrl),this.unbuild(),a.removeClass(r)):this.isImg?a.off(H,this.start):this.$clone&&this.$clone.remove(),a.removeData(c)},move:function(a,b){var c=this.canvas,d=c.left,e=c.top;this.moveTo(Y(a)?a:d+Number(a),Y(b)?b:e+Number(b))},moveTo:function(a,b){var c=this.canvas,d=!1;Y(b)&&(b=a),a=Number(a),b=Number(b),this.ready&&!this.disabled&&this.options.movable&&(X(a)&&(c.left=a,d=!0),X(b)&&(c.top=b,d=!0),d&&this.renderCanvas(!0))},zoom:function(a,b){var c=this.canvas;a=Number(a),a=0>a?1/(1-a):1+a,this.zoomTo(c.width*a/c.naturalWidth,b)},zoomTo:function(a,b){var j,k,l,m,n,c=this.options,d=this.pointers,e=this.canvas,f=e.width,g=e.height,h=e.naturalWidth,i=e.naturalHeight;if(a=Number(a),a>=0&&this.ready&&!this.disabled&&c.zoomable){if(j=h*a,k=i*a,l=void 0,b&&(l=b.originalEvent),this.trigger(O,{originalEvent:l,oldRatio:f/h,ratio:j/h}).isDefaultPrevented())return;l?(m=this.$cropper.offset(),n=d&&$(d).length?jb(d):{pageX:b.pageX||l.pageX||0,pageY:b.pageY||l.pageY||0},e.left-=(j-f)*((n.pageX-m.left-e.left)/f),e.top-=(k-g)*((n.pageY-m.top-e.top)/g)):(e.left-=(j-f)/2,e.top-=(k-g)/2),e.width=j,e.height=k,this.renderCanvas(!0)}},rotate:function(a){this.rotateTo((this.image.rotate||0)+Number(a))},rotateTo:function(a){a=Number(a),X(a)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.image.rotate=a%360,this.renderCanvas(!0,!0))},scaleX:function(a){var b=this.image.scaleY;this.scale(a,X(b)?b:1)},scaleY:function(a){var b=this.image.scaleX;this.scale(X(b)?b:1,a)},scale:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,c=this.image,d=!1;a=Number(a),b=Number(b),this.ready&&!this.disabled&&this.options.scalable&&(X(a)&&(c.scaleX=a,d=!0),X(b)&&(c.scaleY=b,d=!0),d&&this.renderCanvas(!0,!0))},getData:function(){var h,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!1,c=this.options,d=this.image,e=this.canvas,f=this.cropBox,g=void 0;return this.ready&&this.cropped?(g={x:f.left-e.left,y:f.top-e.top,width:f.width,height:f.height},h=d.width/d.naturalWidth,a.each(g,function(a,c){c/=h,g[a]=b?Math.round(c):c})):g={x:0,y:0,width:0,height:0},c.rotatable&&(g.rotate=d.rotate||0),c.scalable&&(g.scaleX=d.scaleX||1,g.scaleY=d.scaleY||1),g},setData:function(b){var g,h,c=this.options,d=this.image,e=this.canvas,f={};a.isFunction(b)&&(b=b.call(this.element)),this.ready&&!this.disabled&&a.isPlainObject(b)&&(g=!1,c.rotatable&&X(b.rotate)&&b.rotate!==d.rotate&&(d.rotate=b.rotate,g=!0),c.scalable&&(X(b.scaleX)&&b.scaleX!==d.scaleX&&(d.scaleX=b.scaleX,g=!0),X(b.scaleY)&&b.scaleY!==d.scaleY&&(d.scaleY=b.scaleY,g=!0)),g&&this.renderCanvas(!0,!0),h=d.width/d.naturalWidth,X(b.x)&&(f.left=b.x*h+e.left),X(b.y)&&(f.top=b.y*h+e.top),X(b.width)&&(f.width=b.width*h),X(b.height)&&(f.height=b.height*h),this.setCropBoxData(f))},getContainerData:function(){return this.ready?a.extend({},this.container):{}},getImageData:function(){return this.loaded?a.extend({},this.image):{}},getCanvasData:function(){var b=this.canvas,c={};return this.ready&&a.each(["left","top","width","height","naturalWidth","naturalHeight"],function(a,d){c[d]=b[d]}),c},setCanvasData:function(b){var c=this.canvas,d=c.aspectRatio;a.isFunction(b)&&(b=b.call(this.$element)),this.ready&&!this.disabled&&a.isPlainObject(b)&&(X(b.left)&&(c.left=b.left),X(b.top)&&(c.top=b.top),X(b.width)?(c.width=b.width,c.height=b.width/d):X(b.height)&&(c.height=b.height,c.width=b.height*d),this.renderCanvas(!0))},getCropBoxData:function(){var a=this.cropBox;return this.ready&&this.cropped?{left:a.left,top:a.top,width:a.width,height:a.height}:{}},setCropBoxData:function(b){var c=this.cropBox,d=this.options.aspectRatio,e=void 0,f=void 0;a.isFunction(b)&&(b=b.call(this.$element)),this.ready&&this.cropped&&!this.disabled&&a.isPlainObject(b)&&(X(b.left)&&(c.left=b.left),X(b.top)&&(c.top=b.top),X(b.width)&&b.width!==c.width&&(e=!0,c.width=b.width),X(b.height)&&b.height!==c.height&&(f=!0,c.height=b.height),d&&(e?c.height=c.width/d:f&&(c.width=c.height*d)),this.renderCropBox())},getCroppedCanvas:function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.ready&&b.HTMLCanvasElement?(c=this.canvas,d=nb(this.$clone[0],this.image,c,a),this.cropped?(e=this.getData(),f=e.x,g=e.y,h=e.width,i=e.height,j=h/i,k=lb({aspectRatio:j,width:a.maxWidth||1/0,height:a.maxHeight||1/0}),l=lb({aspectRatio:j,width:a.minWidth||0,height:a.minHeight||0}),m=lb({aspectRatio:j,width:a.width||h,height:a.height||i}),n=m.width,o=m.height,n=Math.min(k.width,Math.max(l.width,n)),o=Math.min(k.height,Math.max(l.height,o)),p=document.createElement("canvas"),q=p.getContext("2d"),p.width=n,p.height=o,q.fillStyle=a.fillColor||"transparent",q.fillRect(0,0,n,o),r=a.imageSmoothingEnabled,s=void 0===r?!0:r,t=a.imageSmoothingQuality,q.imageSmoothingEnabled=s,t&&(q.imageSmoothingQuality=t),u=d.width,v=d.height,w=f,x=g,y=void 0,z=void 0,A=void 0,B=void 0,C=void 0,D=void 0,-h>=w||w>u?(w=0,y=0,A=0,C=0):0>=w?(A=-w,w=0,y=Math.min(u,h+w),C=y):u>=w&&(A=0,y=Math.min(h,u-w),C=y),0>=y||-i>=x||x>v?(x=0,z=0,B=0,D=0):0>=x?(B=-x,x=0,z=Math.min(v,i+x),D=z):v>=x&&(B=0,z=Math.min(i,v-x),D=z),E=[Math.floor(w),Math.floor(x),Math.floor(y),Math.floor(z)],C>0&&D>0&&(F=n/h,E.push(Math.floor(A*F),Math.floor(B*F),Math.floor(C*F),Math.floor(D*F))),q.drawImage.apply(q,[d].concat(E)),p):d):null},setAspectRatio:function(a){var b=this.options;this.disabled||Y(a)||(b.aspectRatio=Math.max(0,a)||0/0,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox()))},setDragMode:function(a){var b=this.options,c=void 0,d=void 0;this.loaded&&!this.disabled&&(c=a===y,d=b.movable&&a===z,a=c||d?a:A,this.$dragBox.data(w,a).toggleClass(p,c).toggleClass(v,d),b.cropBoxMovable||this.$face.data(w,a).toggleClass(p,c).toggleClass(v,d))}},Bb=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Db=function(){function e(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Cb(this,e),!b||!S.test(b.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=b,this.$element=a(b),this.options=a.extend({},T,a.isPlainObject(c)&&c),this.completed=!1,this.cropped=!1,this.disabled=!1,this.isImg=!1,this.limited=!1,this.loaded=!1,this.ready=!1,this.replaced=!1,this.wheeling=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.pointers={},this.init()}return Bb(e,[{key:"init",value:function(){var a=this.$element,c=void 0;if(a.is("img")){if(this.isImg=!0,c=a.attr("src")||"",this.originalUrl=c,!c)return;c=a.prop("src")}else a.is("canvas")&&b.HTMLCanvasElement&&(c=a[0].toDataURL());this.load(c)}},{key:"trigger",value:function(b,c){var d=a.Event(b,c);return this.$element.trigger(d),d}},{key:"load",value:function(a){var d,e,f,c=this;if(a){if(this.url=a,this.image={},d=this.$element,e=this.options,!e.checkOrientation||!b.ArrayBuffer)return this.clone(),void 0;if(Q.test(a))return R.test(a)?this.read(rb(a)):this.clone(),void 0;f=new XMLHttpRequest,f.onerror=function(){c.clone()},f.onload=function(){c.read(f.response)},e.checkCrossOrigin&&bb(a)&&d.prop("crossOrigin")&&(a=cb(a)),f.open("get",a),f.responseType="arraybuffer",f.withCredentials="use-credentials"===d.prop("crossOrigin"),f.send()}}},{key:"read",value:function(a){var h,b=this.options,c=this.image,d=tb(a),e=0,f=1,g=1;d>1&&(this.url=sb(a,"image/jpeg"),h=ub(d),e=h.rotate,f=h.scaleX,g=h.scaleY),b.rotatable&&(c.rotate=e),b.scalable&&(c.scaleX=f,c.scaleY=g),this.clone()}},{key:"clone",value:function(){var g,h,b=this.$element,c=this.options,d=this.url,e="",f=void 0;c.checkCrossOrigin&&bb(d)&&(e=b.prop("crossOrigin"),e?f=d:(e="anonymous",f=cb(d))),this.crossOrigin=e,this.crossOriginUrl=f,g=document.createElement("img"),e&&(g.crossOrigin=e),g.src=f||d,h=a(g),this.$clone=h,this.isImg?this.element.complete?this.start():b.one(H,a.proxy(this.start,this)):h.one(H,a.proxy(this.start,this)).one(G,a.proxy(this.stop,this)).addClass(s).insertAfter(b)}},{key:"start",value:function(){var b=this,c=this.$clone,d=this.$element;this.isImg||(c.off(G,this.stop),d=c),gb(d[0],function(c,d){a.extend(b.image,{naturalWidth:c,naturalHeight:d,aspectRatio:c/d}),b.loaded=!0,b.build()})}},{key:"stop",value:function(){this.$clone.remove(),this.$clone=null}},{key:"build",value:function(){var e,f,g,h,i,j,b=this;this.loaded&&(this.ready&&this.unbuild(),e=this.$element,f=this.options,g=this.$clone,h=a(U),i=h.find("."+c+"-crop-box"),j=i.find("."+c+"-face"),this.$container=e.parent(),this.$cropper=h,this.$canvas=h.find("."+c+"-canvas").append(g),this.$dragBox=h.find("."+c+"-drag-box"),this.$cropBox=i,this.$viewBox=h.find("."+c+"-view-box"),this.$face=j,e.addClass(r).after(h),this.isImg||g.removeClass(s),this.initPreview(),this.bind(),f.aspectRatio=Math.max(0,f.aspectRatio)||0/0,f.viewMode=Math.max(0,Math.min(3,Math.round(f.viewMode)))||0,this.cropped=f.autoCrop,f.autoCrop?f.modal&&this.$dragBox.addClass(u):i.addClass(r),f.guides||i.find("."+c+"-dashed").addClass(r),f.center||i.find("."+c+"-center").addClass(r),f.cropBoxMovable&&j.addClass(v).data(w,d),f.highlight||j.addClass(t),f.background&&h.addClass(c+"-bg"),f.cropBoxResizable||i.find("."+c+"-line,."+c+"-point").addClass(r),this.setDragMode(f.dragMode),this.render(),this.ready=!0,this.setData(f.data),this.completing=setTimeout(function(){a.isFunction(f.ready)&&e.one(L,f.ready),b.trigger(L),b.trigger(B,b.getData()),b.completed=!0},0))}},{key:"unbuild",value:function(){this.ready&&(this.completed||clearTimeout(this.completing),this.ready=!1,this.completed=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)}}],[{key:"setDefaults",value:function(b){a.extend(T,a.isPlainObject(b)&&b)}}]),e}(),a.extend&&a.extend(Db.prototype,vb,wb,xb,yb,zb,Ab),a.fn&&(Eb=a.fn.cropper,a.fn.cropper=function(b){var d,e,f,g;for(d=arguments.length,e=Array(d>1?d-1:0),f=1;d>f;f++)e[f-1]=arguments[f];return g=void 0,this.each(function(d,f){var j,k,h=a(f),i=h.data(c);if(!i){if(/destroy/.test(b))return;j=a.extend({},h.data(),a.isPlainObject(b)&&b),i=new Db(f,j),h.data(c,i)}V(b)&&(k=i[b],a.isFunction(k)&&(g=k.apply(i,e)))}),Y(g)?this:g},a.fn.cropper.Constructor=Db,a.fn.cropper.setDefaults=Db.setDefaults,a.fn.cropper.noConflict=function(){return a.fn.cropper=Eb,this})});